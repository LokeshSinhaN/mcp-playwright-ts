(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();const w="http://localhost:5000";async function d(e,t){const n=await fetch(w+e,{headers:{"Content-Type":"application/json"},...t});if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.json()}const f={execute(e,t={}){return d("/api/execute",{method:"POST",body:JSON.stringify({action:e,...t})})},screenshot(){return d("/api/screenshot")},health(){return d("/api/health")}};class E{constructor(){this.ws=null,this.handlers=new Set}connect(t="ws://localhost:5000"){this.ws=new WebSocket(t),this.ws.onmessage=n=>{try{const o=JSON.parse(n.data);for(const s of this.handlers)s(o)}catch(o){console.error("Bad WS payload",o)}}}on(t){this.handlers.add(t)}}const g=new E,l=document.getElementById("chat-log"),S=document.getElementById("chat-form"),m=document.getElementById("prompt-input"),c=document.getElementById("browser-screenshot"),y=document.getElementById("browser-placeholder"),B=document.getElementById("take-screenshot-btn"),L=document.getElementById("close-session-btn"),u=document.getElementById("ws-status-dot"),h=document.getElementById("ws-status-text");function p(e,t){!u||!h||(u.classList.remove("connected","disconnected","error"),u.classList.add(e),h.textContent=t)}function a(e){const t=document.createElement("div");t.className=`chat-entry ${e.type} ${"role"in e?e.role:"system"}`;const n=document.createElement("span");n.className="timestamp",n.textContent=e.timestamp?new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";const o=document.createElement("span");o.className="message",o.textContent=e.message,t.appendChild(n),t.appendChild(o),l.appendChild(t),l.scrollTop=l.scrollHeight}g.on(e=>{e.type==="log"&&p("connected","Connected"),e.type==="error"&&p("error","Error"),a(e)});g.connect();S.addEventListener("submit",async e=>{e.preventDefault();const t=m.value.trim();if(!t)return;a({type:"info",message:t,role:"user"}),m.value="";const n=/^https?:\/\//i.test(t),o="navigate";try{const s=await f.execute(o,n?{url:t}:{});s.screenshot&&(c.src=s.screenshot,c.hidden=!1,y.hidden=!0)}catch(s){a({type:"error",message:s.message??String(s)})}});B.addEventListener("click",async()=>{try{const e=await f.screenshot();e.screenshot&&(c.src=e.screenshot,c.hidden=!1,y.hidden=!0)}catch(e){a({type:"error",message:e.message??String(e)})}});L.addEventListener("click",()=>{location.reload()});
